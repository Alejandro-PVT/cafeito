{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Golux/Downloads/CafeITOax/lib/db.ts"],"sourcesContent":["import mysql from \"mysql2/promise\"\n\nconst pool = mysql.createPool({\n  host: process.env.DB_HOST || \"localhost\",\n  user: process.env.DB_USER || \"root\",\n  password: process.env.DB_PASSWORD || \"\",\n  database: process.env.DB_NAME || \"cafeito_db\",\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n})\n\nexport async function query(sql: string, values?: any[]) {\n  const connection = await pool.getConnection()\n  try {\n    const [results] = await connection.execute(sql, values || [])\n    return results\n  } finally {\n    connection.release()\n  }\n}\n\nexport default pool\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC5B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;IACjC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;AACd;AAEO,eAAe,MAAM,GAAW,EAAE,MAAc;IACrD,MAAM,aAAa,MAAM,KAAK,aAAa;IAC3C,IAAI;QACF,MAAM,CAAC,QAAQ,GAAG,MAAM,WAAW,OAAO,CAAC,KAAK,UAAU,EAAE;QAC5D,OAAO;IACT,SAAU;QACR,WAAW,OAAO;IACpB;AACF;uCAEe"}},
    {"offset": {"line": 149, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Golux/Downloads/CafeITOax/app/api/orders/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { query } from \"@/lib/db\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const adminId = request.cookies.get(\"auth_token\")?.value\n    if (!adminId) {\n      return NextResponse.json({ error: \"No autorizado\" }, { status: 401 })\n    }\n\n    const results = await query(`SELECT * FROM orders ORDER BY created_at DESC LIMIT 100`)\n    return NextResponse.json(results)\n  } catch (error) {\n    console.error(\"Error obteniendo órdenes:\", error)\n    return NextResponse.json({ error: \"Error obteniendo órdenes\" }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { customer_name, customer_email, customer_phone, items, payment_method, notes } = await request.json()\n\n    if (!items || items.length === 0) {\n      return NextResponse.json({ error: \"Orden sin items\" }, { status: 400 })\n    }\n\n    const orderNumber = `ORD-${Date.now()}`\n    let total = 0\n\n    // Calculate total\n    for (const item of items) {\n      const products: any[] = await query(\"SELECT price FROM products WHERE id = ?\", [item.product_id])\n      if (products.length > 0) {\n        total += products[0].price * item.quantity\n      }\n    }\n\n    const orderResults: any[] = await query(\n      `INSERT INTO orders (order_number, customer_name, customer_email, customer_phone, total, payment_method, notes)\n       VALUES (?, ?, ?, ?, ?, ?, ?)`,\n      [orderNumber, customer_name, customer_email, customer_phone, total, payment_method, notes],\n    )\n\n    const orderId = orderResults.insertId || orderResults[0]?.id\n\n    // Insert order items\n    for (const item of items) {\n      const products: any[] = await query(\"SELECT price FROM products WHERE id = ?\", [item.product_id])\n      const unitPrice = products[0]?.price || 0\n      const subtotal = unitPrice * item.quantity\n\n      await query(\n        `INSERT INTO order_items (order_id, product_id, quantity, unit_price, subtotal)\n         VALUES (?, ?, ?, ?, ?)`,\n        [orderId, item.product_id, item.quantity, unitPrice, subtotal],\n      )\n\n      // Update inventory\n      await query(\n        `INSERT INTO inventory_logs (product_id, quantity_change, reason)\n         VALUES (?, ?, ?)`,\n        [item.product_id, -item.quantity, \"Venta\"],\n      )\n    }\n\n    return NextResponse.json({ id: orderId, order_number: orderNumber, total }, { status: 201 })\n  } catch (error) {\n    console.error(\"Error creando orden:\", error)\n    return NextResponse.json({ error: \"Error creando orden\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe;QACnD,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,MAAM,UAAU,MAAM,IAAA,oHAAK,EAAC,CAAC,uDAAuD,CAAC;QACrF,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,aAAa,EAAE,cAAc,EAAE,cAAc,EAAE,KAAK,EAAE,cAAc,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE1G,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,GAAG;YAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,cAAc,CAAC,IAAI,EAAE,KAAK,GAAG,IAAI;QACvC,IAAI,QAAQ;QAEZ,kBAAkB;QAClB,KAAK,MAAM,QAAQ,MAAO;YACxB,MAAM,WAAkB,MAAM,IAAA,oHAAK,EAAC,2CAA2C;gBAAC,KAAK,UAAU;aAAC;YAChG,IAAI,SAAS,MAAM,GAAG,GAAG;gBACvB,SAAS,QAAQ,CAAC,EAAE,CAAC,KAAK,GAAG,KAAK,QAAQ;YAC5C;QACF;QAEA,MAAM,eAAsB,MAAM,IAAA,oHAAK,EACrC,CAAC;mCAC4B,CAAC,EAC9B;YAAC;YAAa;YAAe;YAAgB;YAAgB;YAAO;YAAgB;SAAM;QAG5F,MAAM,UAAU,aAAa,QAAQ,IAAI,YAAY,CAAC,EAAE,EAAE;QAE1D,qBAAqB;QACrB,KAAK,MAAM,QAAQ,MAAO;YACxB,MAAM,WAAkB,MAAM,IAAA,oHAAK,EAAC,2CAA2C;gBAAC,KAAK,UAAU;aAAC;YAChG,MAAM,YAAY,QAAQ,CAAC,EAAE,EAAE,SAAS;YACxC,MAAM,WAAW,YAAY,KAAK,QAAQ;YAE1C,MAAM,IAAA,oHAAK,EACT,CAAC;+BACsB,CAAC,EACxB;gBAAC;gBAAS,KAAK,UAAU;gBAAE,KAAK,QAAQ;gBAAE;gBAAW;aAAS;YAGhE,mBAAmB;YACnB,MAAM,IAAA,oHAAK,EACT,CAAC;yBACgB,CAAC,EAClB;gBAAC,KAAK,UAAU;gBAAE,CAAC,KAAK,QAAQ;gBAAE;aAAQ;QAE9C;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAS,cAAc;YAAa;QAAM,GAAG;YAAE,QAAQ;QAAI;IAC5F,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC3E;AACF"}}]
}